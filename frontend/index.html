<!--
  ARQUIVO: frontend/index.html
  DESCRI√á√ÉO: P√°gina principal da GameStore v2.0
  
  Altera√ß√µes em rela√ß√£o √† v1.0:
  ‚úì Integra√ß√£o com API backend
  ‚úì Sistema de autentica√ß√£o
  ‚úì Carrinho de compras
  ‚úì Favoritos/Wishlist
  ‚úì Produtos carregados do banco de dados
  ‚úì Checkout funcional
  
  TODO: Adicionar coment√°rios em portugu√™s em cada se√ß√£o
-->

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameStore - Loja de Jogos Online</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- CABE√áALHO DO SITE -->
    <header class="cabecalho">
        <div class="container">
            <div class="header-top">
                <h1 class="logo">üéÆ GameStore</h1>
                
                <!-- Menu de navega√ß√£o -->
                <nav class="menu">
                    <ul>
                        <li><a href="#inicio">In√≠cio</a></li>
                        <li><a href="#jogos">Jogos</a></li>
                        <li><a href="#sobre">Sobre</a></li>
                        <li><a href="#contato">Contato</a></li>
                    </ul>
                </nav>

                <!-- √Årea de usu√°rio / Login -->
                <div class="area-usuario">
                    <!-- Bot√µes antes de logar -->
                    <div id="naologado" class="btns-login">
                        <a href="/frontend/login.html" class="btn-login">Login</a>
                        <a href="/frontend/login.html" class="btn-registrar">Registrar</a>
                    </div>

                    <!-- √Årea ap√≥s logar -->
                    <div id="logado" class="info-usuario" style="display: none;">
                        <!-- Nome do usu√°rio -->
                        <span id="nomeUsuario" class="nome-usuario"></span>
                        
                        <!-- √çcones de a√ß√µes -->
                        <a href="/frontend/favoritos.html" class="icone-favoritos" title="Favoritos">
                            ‚ù§Ô∏è <span id="contadorFavoritos">0</span>
                        </a>
                        
                        <a href="/frontend/carrinho.html" class="icone-carrinho" title="Carrinho">
                            üõí <span id="contadorCarrinho">0</span>
                        </a>
                        
                        <button onclick="fazerLogout()" class="btn-logout">Sair</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- CONTE√öDO PRINCIPAL -->
    <main>
        <!-- SE√á√ÉO HERO (IN√çCIO) -->
        <section id="inicio" class="hero">
            <div class="container">
                <h2>Bem-vindo √† GameStore!</h2>
                <p>A melhor loja de jogos online do Brasil. Milhares de t√≠tulos com os melhores pre√ßos.</p>
                <a href="#jogos" class="btn">Ver Ofertas</a>
            </div>
        </section>

        <!-- SE√á√ÉO FILTROS -->
        <section class="filtros">
            <div class="container">
                <h3>Filtrar Jogos</h3>
                
                <div class="opcoes-filtro">
                    <!-- Filtro por g√™nero -->
                    <select id="filtroGenero" onchange="filtrarJogos()">
                        <option value="">Todos os g√™neros</option>
                        <option value="RPG">RPG</option>
                        <option value="FPS">FPS</option>
                        <option value="A√ß√£o-Aventura">A√ß√£o-Aventura</option>
                        <option value="Esportes">Esportes</option>
                        <option value="Estrat√©gia">Estrat√©gia</option>
                    </select>

                    <!-- Filtro por pre√ßo -->
                    <select id="filtroPreco" onchange="filtrarJogos()">
                        <option value="">Qualquer pre√ßo</option>
                        <option value="100">At√© R$ 100</option>
                        <option value="200">At√© R$ 200</option>
                        <option value="300">At√© R$ 300</option>
                    </select>

                    <!-- Buscador -->
                    <input 
                        type="text" 
                        id="buscador" 
                        placeholder="Buscar jogo..."
                        onkeyup="buscarJogos()"
                    >
                </div>
            </div>
        </section>

        <!-- SE√á√ÉO DE JOGOS -->
        <section id="jogos" class="jogos">
            <div class="container">
                <h2>Nossos Jogos</h2>
                
                <!-- Mensagem de carregamento -->
                <div id="carregando" class="carregando">
                    ‚è≥ Carregando jogos...
                </div>

                <!-- Grid de produtos -->
                <div id="gridJogos" class="grid-jogos">
                    <!-- Os jogos ser√£o carregados aqui via JavaScript -->
                </div>

                <!-- Mensagem se n√£o encontrar nada -->
                <div id="nenhumResultado" class="vazio" style="display: none;">
                    <p>üòû Nenhum jogo encontrado com esses filtros</p>
                </div>
            </div>
        </section>

        <!-- SE√á√ÉO SOBRE -->
        <section id="sobre" class="sobre">
            <div class="container">
                <h2>Sobre a GameStore</h2>
                
                <p>Somos a maior plataforma de vendas de jogos digitais do Brasil. Com mais de 50 mil clientes satisfeitos e cat√°logo constantemente atualizado.</p>
                
                <div class="info-sobre">
                    <div class="item-sobre">
                        <h3>üéØ Miss√£o</h3>
                        <p>Oferecer os melhores jogos com os melhores pre√ßos para toda a comunidade gamer brasileira.</p>
                    </div>
                    
                    <div class="item-sobre">
                        <h3>üìç Cobertura</h3>
                        <p>Atendemos todo o Brasil via digital. Acesso instant√¢neo aos seus jogos ap√≥s a compra.</p>
                    </div>
                    
                    <div class="item-sobre">
                        <h3>‚è∞ Suporte</h3>
                        <p>24 horas por dia, 7 dias por semana. Estamos aqui para ajudar!</p>
                    </div>

                    <div class="item-sobre">
                        <h3>üîí Seguran√ßa</h3>
                        <p>Pagamentos seguros com Stripe. Dados protegidos e criptografados.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SE√á√ÉO CONTATO -->
        <section id="contato" class="contato">
            <div class="container">
                <h2>Entre em Contato</h2>
                
                <form class="form-contato" onsubmit="handleContato(event)">
                    <!-- Mensagem -->
                    <div id="mensagemContato" class="mensagem" style="display: none;"></div>

                    <!-- Nome -->
                    <div class="grupo-form">
                        <label for="nome">Seu Nome:</label>
                        <input type="text" id="nome" placeholder="Jo√£o Silva" required>
                    </div>
                    
                    <!-- Email -->
                    <div class="grupo-form">
                        <label for="email">Seu Email:</label>
                        <input type="email" id="email" placeholder="seu@email.com" required>
                    </div>
                    
                    <!-- Mensagem -->
                    <div class="grupo-form">
                        <label for="mensagem">Mensagem:</label>
                        <textarea id="mensagem" placeholder="Como podemos ajudar?" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn">Enviar Mensagem</button>
                </form>
            </div>
        </section>
    </main>

    <!-- RODAP√â -->
    <footer class="rodape">
        <div class="container">
            <p>&copy; 2024 GameStore. Todos os direitos reservados.</p>
            <p>Desenvolvido com ‚ù§Ô∏è para a comunidade gamer</p>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <!-- Carregar script da pasta public (servido como arquivo est√°tico com MIME type correto) -->
    <script src="/script.js"></script>
    <script>
        /*
          ARQUIVO: frontend/index.html (JavaScript embarcado)
          DESCRI√á√ÉO: L√≥gica da p√°gina principal
          
          Este c√≥digo:
          - Carrega produtos do servidor
          - Gerencia carrinho e favoritos
          - Trata login/logout
          - Implementa filtros e busca
        */

        // ============================================
        // INICIALIZAR P√ÅGINA
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            console.log('üéÆ GameStore carregado!');
            
            // Verificar se usu√°rio est√° logado
            verificarLogin();
            
            // Carregar jogos do servidor
            carregarJogos();
            
            // Atualizar contadores
            atualizarContadores();
        });

        // ============================================
        // FUN√á√ÉO: Verificar se usu√°rio est√° logado
        // ============================================
        function verificarLogin() {
            const token = localStorage.getItem('token');
            const usuario = localStorage.getItem('usuario');

            if (token && usuario) {
                // Usu√°rio logado
                const dadosUsuario = JSON.parse(usuario);
                
                // Esconder bot√µes de login
                document.getElementById('naologado').style.display = 'none';
                
                // Mostrar √°rea de usu√°rio
                document.getElementById('logado').style.display = 'flex';
                
                // Exibir nome
                document.getElementById('nomeUsuario').textContent = `üë§ ${dadosUsuario.nome}`;
                
                console.log('‚úÖ Usu√°rio logado:', dadosUsuario.email);
            } else {
                // Usu√°rio n√£o logado
                document.getElementById('naologado').style.display = 'flex';
                document.getElementById('logado').style.display = 'none';
            }
        }

        // ============================================
        // FUN√á√ÉO: Fazer logout
        // ============================================
        function fazerLogout() {
            if (confirm('Tem certeza que deseja sair?')) {
                // Remover dados
                localStorage.removeItem('token');
                localStorage.removeItem('usuario');
                localStorage.removeItem('carrinho');
                localStorage.removeItem('favoritos');
                
                // Recarregar p√°gina
                window.location.href = '/';
            }
        }

        // ============================================
        // FUN√á√ÉO: Carregar jogos do servidor
        // ============================================
        async function carregarJogos() {
            console.log('üì¶ Carregando jogos do servidor...');

            try {
                const resposta = await fetch('/api/jogos');
                const dados = await resposta.json();

                if (resposta.ok) {
                    console.log(`‚úÖ ${dados.total} jogos carregados!`);
                    
                    // Guardar jogos em vari√°vel global
                    window.todosOsJogos = dados.jogos;
                    
                    // Exibir jogos
                    exibirJogos(dados.jogos);
                    
                    // Esconder mensagem de carregamento
                    document.getElementById('carregando').style.display = 'none';
                } else {
                    console.error('‚ùå Erro ao carregar:', dados.erro);
                    document.getElementById('carregando').textContent = '‚ùå Erro ao carregar jogos';
                }

            } catch (erro) {
                console.error('‚ùå Erro:', erro);
                document.getElementById('carregando').textContent = '‚ùå Erro ao conectar ao servidor';
            }
        }

        // ============================================
        // FUN√á√ÉO: Exibir jogos na tela
        // ============================================
        function exibirJogos(jogos) {
            const grid = document.getElementById('gridJogos');
            const nenhumResultado = document.getElementById('nenhumResultado');

            // Limpar grid
            grid.innerHTML = '';

            if (jogos.length === 0) {
                nenhumResultado.style.display = 'block';
                return;
            }

            nenhumResultado.style.display = 'none';

            // Criar card para cada jogo
            jogos.forEach(jogo => {
                const card = document.createElement('div');
                card.className = 'card-jogo';
                card.innerHTML = `
                    <!-- Imagem do jogo -->
                    <img src="${jogo.imagem_url}" alt="${jogo.nome}" onerror="this.src='https://via.placeholder.com/300x400?text=Sem+Imagem'">
                    
                    <!-- T√≠tulo -->
                    <h3>${jogo.nome}</h3>
                    
                    <!-- Descri√ß√£o curta -->
                    <p class="descricao">${jogo.descricao.substring(0, 100)}...</p>
                    
                    <!-- Detalhes -->
                    <p class="detalhes">
                        <span class="genero">${jogo.genero}</span>
                        <span class="classificacao">${jogo.classificacao}</span>
                    </p>
                    
                    <!-- Pre√ßo -->
                    <p class="preco">R$ ${jogo.preco.toFixed(2)}</p>
                    
                    <!-- Bot√µes de a√ß√£o -->
                    <div class="botoes-card">
                        <button class="btn" onclick="adicionarAoCarrinho(${jogo.id})">
                            üõí Comprar
                        </button>
                        <button class="btn-favorito" onclick="adicionarAosFavoritos(${jogo.id})" title="Adicionar aos favoritos">
                            ‚ù§Ô∏è
                        </button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // ============================================
        // FUN√á√ÉO: Filtrar jogos
        // ============================================
        function filtrarJogos() {
            const genero = document.getElementById('filtroGenero').value;
            const precoMax = document.getElementById('filtroPreco').value;

            if (!window.todosOsJogos) return;

            let jogos = window.todosOsJogos;

            // Filtrar por g√™nero
            if (genero) {
                jogos = jogos.filter(j => j.genero === genero);
            }

            // Filtrar por pre√ßo
            if (precoMax) {
                jogos = jogos.filter(j => j.preco <= parseFloat(precoMax));
            }

            exibirJogos(jogos);
        }

        // ============================================
        // FUN√á√ÉO: Buscar jogos
        // ============================================
        function buscarJogos() {
            const termo = document.getElementById('buscador').value.toLowerCase();

            if (!window.todosOsJogos) return;

            const jogos = window.todosOsJogos.filter(j =>
                j.nome.toLowerCase().includes(termo) ||
                j.descricao.toLowerCase().includes(termo)
            );

            exibirJogos(jogos);
        }

        // ============================================
        // FUN√á√ÉO: Adicionar ao carrinho
        // ============================================
        function adicionarAoCarrinho(jogoId) {
            const token = localStorage.getItem('token');

            if (!token) {
                alert('‚ùå Voc√™ precisa estar logado para adicionar ao carrinho');
                window.location.href = '/frontend/login.html';
                return;
            }

            // Guardar no localStorage tamb√©m (para funcionar offline)
            let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            
            const itemExistente = carrinho.find(item => item.jogoId === jogoId);
            
            if (itemExistente) {
                itemExistente.quantidade++;
            } else {
                carrinho.push({ jogoId, quantidade: 1 });
            }

            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            
            console.log('‚úÖ Adicionado ao carrinho');
            alert('‚úÖ Jogo adicionado ao carrinho!');
            
            atualizarContadores();
        }

        // ============================================
        // FUN√á√ÉO: Adicionar aos favoritos
        // ============================================
        function adicionarAosFavoritos(jogoId) {
            const token = localStorage.getItem('token');

            if (!token) {
                alert('‚ùå Voc√™ precisa estar logado para adicionar aos favoritos');
                window.location.href = '/frontend/login.html';
                return;
            }

            let favoritos = JSON.parse(localStorage.getItem('favoritos') || '[]');

            if (favoritos.includes(jogoId)) {
                favoritos = favoritos.filter(id => id !== jogoId);
                console.log('‚ùå Removido dos favoritos');
            } else {
                favoritos.push(jogoId);
                console.log('‚ù§Ô∏è Adicionado aos favoritos');
            }

            localStorage.setItem('favoritos', JSON.stringify(favoritos));
            atualizarContadores();
        }

        // ============================================
        // FUN√á√ÉO: Atualizar contadores
        // ============================================
        function atualizarContadores() {
            const carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            const favoritos = JSON.parse(localStorage.getItem('favoritos') || '[]');

            document.getElementById('contadorCarrinho').textContent = carrinho.length;
            document.getElementById('contadorFavoritos').textContent = favoritos.length;
        }

        // ============================================
        // FUN√á√ÉO: Handle contato
        // ============================================
        async function handleContato(event) {
            event.preventDefault();

            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const mensagem = document.getElementById('mensagem').value;

            console.log('üìß Enviando contato:', email);

            // Valida√ß√£o simples
            if (!nome || !email || !mensagem) {
                alert('‚ùå Preencha todos os campos');
                return;
            }

            // Simular envio (em produ√ß√£o, enviar para servidor)
            alert(`‚úÖ Obrigado, ${nome}! Sua mensagem foi enviada.`);

            // Limpar formul√°rio
            document.getElementById('nome').value = '';
            document.getElementById('email').value = '';
            document.getElementById('mensagem').value = '';
        }
    </script>
</body>
</html>
